<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16x16.png">
    <link rel="manifest" href="icon/manifest.json">
    <title>Baidu Tracker Demo</title>
    <style type="text/css">
        html {
            height: 100%
        }


        body {
            height: 100%;
            margin: 0px;
            padding: 0px
        }


        #container {
            height: 100%
        }
    </style>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=B81d9d62c6fa63a3442cd3b6c7c020b2">

    </script>
</head>


<body>
    <div id="container"></div>
    <script type="text/javascript">
        $.cookie.json = true;
        var points = $.cookie('points') || [];


        /* 创建地图并添加控件begin */
        var map = new BMap.Map("container");
        map.centerAndZoom(new BMap.Point(121.421, 29.326), 13);   // 初始化地图,设置中心点坐标和地图级别
        map.addControl(new BMap.NavigationControl());
        map.addControl(new BMap.ScaleControl());
        map.addControl(new BMap.OverviewMapControl());
        map.addControl(new BMap.MapTypeControl());  //添加地图类型控件
        map.setCurrentCity("北京");  // 设置地图显示的城市 此项是必须设置的
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function (r) {
            if (this.getStatus() == BMAP_STATUS_SUCCESS) {

                var mk = new BMap.Marker(r.point);
                points.push(r.point);
                $.cookie('points', points);
                map.addOverlay(mk);
                map.panTo(r.point);
                map.setCurrentCity(r.address.city);
                alert('您的位置：' + r.address.city + r.point.lng + ',' + r.point.lat);
                doTask();
            }
            else {
                alert('failed' + this.getStatus());
            }
        }, { enableHighAccuracy: true })



        /* 创建地图并添加控件end  */








        function getCurrentPosition() {
            geolocation.getCurrentPosition(function (r) {
                if (this.getStatus() == BMAP_STATUS_SUCCESS) {
                    points.push(r.point);
                    console.log(r);
                    $.cookie('points', points);
                }
                else {
                    alert('failed' + this.getStatus());
                }
            }, { enableHighAccuracy: true })
        }





        function showPolyLine() {

            var color = 'blue';

            points = points.filter(function (value, index, self) {
                return index === self.indexOf(value)
            })

            $.cookie('points', points);


            $.each(points, function (k, v) {
                var marker = new BMap.Marker(v);  // 创建标注
                map.addOverlay(marker);               // 将标注添加到地图中
            })


            /* 添加轨迹接口begin */
            var polyline = new BMap.Polyline(points, {
                strokeColor: color,
                strokeWeight: 6,
                strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            /* 添加轨迹接口begin */

        };

        function doTask() {

            showPolyLine();
            getCurrentPosition();

        }

        

        setInterval(function () {
            doTask()
        }, 10000)
    </script>
</body>

</html>